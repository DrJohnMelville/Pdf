# Name

Names are important in PDF.  In the PDF file format names are preceded by a forward slash (/) and this convention carries over to the documentation.  Names are used as indexes to dictionaries, and names are used extensively throughout the pdf standard essentially as enums.  For example the /SubType field of a font dictionary can take values /Type0, /Type1, /Type3, /MMType1, /TrueType, /OpenType, /CIDFontType0, or /CIDFontType2.

Melville.Pdf uses the [flyweight](https://en.wikipedia.org/wiki/Flyweight_pattern) pattern for pdf names.  the constructors for PDF name are internal, so you should find it difficult to create them.  Most of the
names in the PDF standard are static fields on the KnownNames class.  For names that are not pre-defines
you can request the name from the NameDirectory class.  

## Pdf Names have Reference Identity and unique hashes
NameDirectory makes sure that there is at most 1 PdfName object with a given value.  Thus reference equality is sufficient when comparing PdfNames.

The GetHashCode implementation for PdfName uses the FNV hash which has the nice property that all of the standard pdf names have unique hashes under FNV.  This is useful because that means that the hash code can be used in switch statements over PdfNames very efficiently.  The KnownNameKeys class has an int constant that that is the hash for every KnownNames member of the same name.  Through the magic optimization these constants disappear during the compilation process.

## Pdf Groups

A problem came up in the Pdf generator code.  Often the generator knows that only one of a small number of PdfNames is valid for a given parameter.  For this I added PdfName Groups.  These groups are generated by the KnownNamesGenerator which runs at compile time.  Each group is a [costume](Costumes.md) pattern object arround the PdfName that makes it look like a little enum.  The generated implementation for the BoxName name group looks like this.

````c#
public readonly struct BoxName 
{
    private readonly PdfName name;
    public BoxName(PdfName name){ this.name = name;}
    public static implicit operator PdfName(BoxName wrapper) => wrapper.name; 
    public static BoxName ArtBox => new(KnownNames.ArtBox);
    public static BoxName BleedBox => new(KnownNames.BleedBox);
    public static BoxName CropBox => new(KnownNames.CropBox);
    public static BoxName MediaBox => new(KnownNames.MediaBox);
    public static BoxName TrimBox => new(KnownNames.TrimBox);
}
````

And a method to extract any of the box types from an IHasPageAttributes object is declared as
````c#
private static ValueTask<PdfRect?> GetBoxOrDefaultAsync( IHasPageAttributes item, BoxName? boxType) => ...
````

The BoxName stuct is implicitly convertable to PdfName, so you can use it anywhere you can use a PdfName,
however, when using intellisense with the GetBoxOrDefaultAsync method, the static properties of the type
all show up just like members of the enum.