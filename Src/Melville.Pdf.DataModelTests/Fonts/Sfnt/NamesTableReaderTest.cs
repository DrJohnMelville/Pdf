using System.Threading.Tasks;
using FluentAssertions;
using Melville.Fonts.SfntParsers.TableDeclarations.Names;
using Melville.Parsing.MultiplexSources;
using Melville.Parsing.ObjectRentals;
using Melville.Pdf.ReferenceDocuments.Utility;
using Xunit;

namespace Melville.Pdf.DataModelTests.Fonts.Sfnt;

public class NamesTableReaderTest
{
    [Theory]
    [InlineData(SfntNameKey.FullFontName, 0xFFFF, "Myanmar Text Bold")]
    [InlineData(SfntNameKey.FullFontName, 1, "Myanmar Text Bold")]
    [InlineData(SfntNameKey.FullFontName, 3, "Myanmar Text Negreta")]
    [InlineData(SfntNameKey.FontFamilyName, 0xFFFF, "Myanmar Text")]
    public async Task ReadStringTableAsync(
        SfntNameKey item, ushort platform, string result)
    {
        using var multiplexSource = MultiplexSourceFactory.Create(sampleData.BitsFromHex());
        var table = await new NameTableParser(multiplexSource).ParseAsync();

        (await table.GetNameAsync(item, platform))
            .Should().Be(result);
    }

    private const string sampleData = """
    0000004A037E0001000000000000003200000001000000000001000C0032
    00010000000000020004003F000100000000000300110032000100000000
    0004001100320001000000000005000C004300010000000000060010004F
    00010000000000080015000700010000000000090036005F000100000000
    000B002A0095000100000000000C001300BF000100000000000D014C00D2
    000100000000000E002A00950003000104030002000E0238000300010403
    00040028021E0003000104050002000A0260000300010405000400240246
    00030001040600020006028400030001040600040020026A000300010407
    0002000802A400030001040700040022028A0003000104080002000C02C6
    0003000104080004002602AC0003000104090000006402D2000300010409
    00010018033600030001040900020008037E000300010409000300220364
    000300010409000400220364000300010409000500180386000300010409
    00060020039E0003000104090008002A02E00003000104090009006C03BE
    000300010409000B0054042A000300010409000C0026047E000300010409
    000D029804A4000300010409000E0054042A00030001040A0002000E0756
    00030001040A00040028073C00030001040B00020012077E00030001040B
    0004002C076400030001040C0002000807AA00030001040C000400220790
    00030001040E0002001007D600030001040E0004002A07BC000300010410
    0002001207AA0003000104100004002C0790000300010413000200060800
    0003000104130004002007E60003000104140002000E0820000300010414
    0004002808060003000104150002001403500003000104150004002E0336
    0003000104160002000E084800030001041600040028082E000300010419
    0002001408700003000104190004002E085600030001041B0002000A089E
    00030001041B00040024088400030001041D0002000602A400030001041D
    00040020028A00030001041F0002000A08C200030001041F0004002408A8
    0003000104240002000C08E60003000104240004002608CC00030001042D
    0002000A090C00030001042D0004002408F200030001080A0002000E0756
    00030001080A00040028073C0003000108160002000E0848000300010816
    00040028082E000300010C0A0002000E0756000300010C0A00040028073C
    000300010C0C0002000807AA000300010C0C000400220790A92032303133
    204D6963726F736F667420436F72706F726174696F6E2E20416C6C205269
    676874732052657365727665642E4D79616E6D6172205465787420426F6C
    6456657273696F6E20312E31304D79616E6D6172546578742D426F6C644A
    6F686E20487564736F6E2E205B4C6174696E207375627365743A20536567
    6F652055492C205374657665204D61747465736F6E2E5D687474703A2F2F
    7777772E6D6963726F736F66742E636F6D2F7479706F6772617068792F66
    6F6E74732F687474703A2F2F7777772E7469726F2E636F6D596F75206D61
    7920757365207468697320666F6E74206173207065726D69747465642062
    79207468652045554C4120666F72207468652070726F6475637420696E20
    7768696368207468697320666F6E7420697320696E636C7564656420746F
    20646973706C617920616E64207072696E7420636F6E74656E742E20596F
    75206D6179206F6E6C792028692920656D626564207468697320666F6E74
    20696E20636F6E74656E74206173207065726D6974746564206279207468
    6520656D62656464696E67207265737472696374696F6E7320696E636C75
    64656420696E207468697320666F6E743B20616E6420286969292074656D
    706F726172696C7920646F776E6C6F6164207468697320666F6E7420746F
    2061207072696E746572206F72206F74686572206F757470757420646576
    69636520746F2068656C70207072696E7420636F6E74656E742E004D0079
    0061006E006D00610072002000540065007800740020004E006500670072
    006500740061004D00790061006E006D0061007200200054006500780074
    002000740075010D006E00E9004D00790061006E006D0061007200200054
    0065007800740020006600650064004D00790061006E006D006100720020
    005400650078007400200046006500740074004D00790061006E006D0061
    0072002000540065007800740020038803BD03C403BF03BD03B100A90020
    00320030003100330020004D006900630072006F0073006F006600740020
    0043006F00720070006F0072006100740069006F006E002E00200041006C
    006C00200052006900670068007400730020005200650073006500720076
    00650064002E004D00790061006E006D0061007200200054006500780074
    00200050006F00670072007500620069006F006E0079004D00790061006E
    006D006100720020005400650078007400200042006F006C006400560065
    007200730069006F006E00200031002E00310030004D00790061006E006D
    006100720054006500780074002D0042006F006C0064004A006F0068006E
    00200048007500640073006F006E002E0020005B004C006100740069006E
    0020007300750062007300650074003A0020005300650067006F00650020
    00550049002C0020005300740065007600650020004D0061007400740065
    0073006F006E002E005D0068007400740070003A002F002F007700770077
    002E006D006900630072006F0073006F00660074002E0063006F006D002F
    007400790070006F006700720061007000680079002F0066006F006E0074
    0073002F0068007400740070003A002F002F007700770077002E00740069
    0072006F002E0063006F006D0059006F00750020006D0061007900200075
    007300650020007400680069007300200066006F006E0074002000610073
    0020007000650072006D0069007400740065006400200062007900200074
    00680065002000450055004C004100200066006F00720020007400680065
    002000700072006F006400750063007400200069006E0020007700680069
    006300680020007400680069007300200066006F006E0074002000690073
    00200069006E0063006C007500640065006400200074006F002000640069
    00730070006C0061007900200061006E00640020007000720069006E0074
    00200063006F006E00740065006E0074002E00200059006F00750020006D
    006100790020006F006E006C0079002000280069002900200065006D0062
    006500640020007400680069007300200066006F006E007400200069006E
    00200063006F006E00740065006E00740020006100730020007000650072
    006D00690074007400650064002000620079002000740068006500200065
    006D00620065006400640069006E00670020007200650073007400720069
    006300740069006F006E007300200069006E0063006C0075006400650064
    00200069006E0020007400680069007300200066006F006E0074003B0020
    0061006E006400200028006900690029002000740065006D0070006F0072
    006100720069006C007900200064006F0077006E006C006F006100640020
    007400680069007300200066006F006E007400200074006F002000610020
    007000720069006E0074006500720020006F00720020006F007400680065
    00720020006F007500740070007500740020006400650076006900630065
    00200074006F002000680065006C00700020007000720069006E00740020
    0063006F006E00740065006E0074002E004D00790061006E006D00610072
    002000540065007800740020004E006500670072006900740061004D0079
    0061006E006D00610072002000540065007800740020004C006900680061
    0076006F006900740075004D00790061006E006D00610072002000540065
    00780074002000470072006100730073006500740074006F004D00790061
    006E006D00610072002000540065007800740020004600E9006C006B00F6
    007600E90072004D00790061006E006D0061007200200054006500780074
    0020005600650074004D00790061006E006D006100720020005400650078
    0074002000480061006C0076006600650074004D00790061006E006D0061
    0072002000540065007800740020004E00650067007200690074006F004D
    00790061006E006D00610072002000540065007800740020041F043E043B
    0443043604380440043D044B0439004D00790061006E006D006100720020
    0054006500780074002000540075010D006E00E9004D00790061006E006D
    00610072002000540065007800740020004B0061006C0131006E004D0079
    0061006E006D00610072002000540065007800740020004B007200650070
    006B006F004D00790061006E006D00610072002000540065007800740020
    004C006F006400690061
    """;
}