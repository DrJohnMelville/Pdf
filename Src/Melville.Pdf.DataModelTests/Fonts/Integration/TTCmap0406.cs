using System.Linq;
using System.Threading.Tasks;
using FluentAssertions;
using Melville.Fonts;
using Melville.Fonts.SfntParsers.TableDeclarations.CMaps;
using Xunit;

namespace Melville.Pdf.DataModelTests.Fonts.Integration;

public class TTCmap0406
{
    private static Task<IGenericFont> loadedFont = IntegrationFontLoader.LoadAsync();

    private async Task<ICmapImplementation?> LoadCmapByIndexAsync(int index) =>
        await (await loadedFont).CmapByIndexAsync(index);

    [Fact]
    public async Task Type4CmapAsync()
    {
        var map = await LoadCmapByIndexAsync(0);
        foreach (var (character, glyph) in testCases)
        {
            map.Map(character).Should().Be(glyph);
        }
    }

    [Fact]
    public async Task Type4CmapEnumerateAsync()
    {
        var map = await LoadCmapByIndexAsync(0);
        map.AllMappings().Where(i=>i.Glyph > 0).Should()
            .BeEquivalentTo(testCases.Select(i => (2, i.Character, i.Glyph)));
    }

    private readonly (ushort Character, ushort Glyph)[] testCases =
    [
        (32, 3),
        (33, 4),
        (34, 5),
        (35, 6),
        (36, 7),
        (37, 8),
        (38, 9),
        (39, 10),
        (40, 11),
        (41, 12),
        (42, 13),
        (43, 14),
        (44, 15),
        (45, 16),
        (46, 17),
        (47, 18),
        (48, 19),
        (49, 20),
        (50, 21),
        (51, 22),
        (52, 23),
        (53, 24),
        (54, 25),
        (55, 26),
        (56, 27),
        (57, 28),
        (58, 29),
        (59, 30),
        (60, 31),
        (61, 32),
        (62, 33),
        (63, 34),
        (64, 35),
        (65, 36),
        (66, 37),
        (67, 38),
        (68, 39),
        (69, 40),
        (70, 41),
        (71, 42),
        (72, 43),
        (73, 44),
        (74, 45),
        (75, 46),
        (76, 47),
        (77, 48),
        (78, 49),
        (79, 50),
        (80, 51),
        (81, 52),
        (82, 53),
        (83, 54),
        (84, 55),
        (85, 56),
        (86, 57),
        (87, 58),
        (88, 59),
        (89, 60),
        (90, 61),
        (91, 62),
        (92, 63),
        (93, 64),
        (94, 65),
        (95, 66),
        (96, 67),
        (97, 68),
        (98, 69),
        (99, 70),
        (100, 71),
        (101, 72),
        (102, 73),
        (103, 74),
        (104, 75),
        (105, 76),
        (106, 77),
        (107, 78),
        (108, 79),
        (109, 80),
        (110, 81),
        (111, 82),
        (112, 83),
        (113, 84),
        (114, 85),
        (115, 86),
        (116, 87),
        (117, 88),
        (118, 89),
        (119, 90),
        (120, 91),
        (121, 92),
        (122, 93),
        (123, 94),
        (124, 95),
        (125, 96),
        (126, 97),
        (160, 3),
        (161, 98),
        (162, 99),
        (163, 100),
        (165, 101),
        (166, 102),
        (167, 103),
        (168, 104),
        (173, 16),
        (177, 105),
        (180, 106),
        (182, 107),
        (183, 108),
        (184, 109),
        (191, 110),
        (192, 111),
        (193, 112),
        (194, 113),
        (195, 114),
        (196, 115),
        (197, 116),
        (198, 117),
        (199, 118),
        (200, 119),
        (201, 120),
        (202, 121),
        (203, 122),
        (204, 123),
        (205, 124),
        (206, 125),
        (207, 126),
        (208, 127),
        (209, 128),
        (210, 129),
        (211, 130),
        (212, 131),
        (213, 132),
        (214, 133),
        (215, 134),
        (216, 135),
        (217, 136),
        (218, 137),
        (219, 138),
        (220, 139),
        (221, 140),
        (222, 141),
        (223, 142),
        (224, 143),
        (225, 144),
        (226, 145),
        (227, 146),
        (228, 147),
        (229, 148),
        (230, 149),
        (231, 150),
        (232, 151),
        (233, 152),
        (234, 153),
        (235, 154),
        (236, 155),
        (237, 156),
        (238, 157),
        (239, 158),
        (240, 159),
        (241, 160),
        (242, 161),
        (243, 162),
        (244, 163),
        (245, 164),
        (246, 165),
        (247, 166),
        (248, 167),
        (249, 168),
        (250, 169),
        (251, 170),
        (252, 171),
        (253, 172),
        (254, 173),
        (255, 174),
        (258, 175),
        (259, 176),
        (260, 177),
        (261, 178),
        (262, 179),
        (263, 180),
        (264, 181),
        (265, 182),
        (266, 183),
        (267, 184),
        (268, 185),
        (269, 186),
        (270, 187),
        (271, 188),
        (272, 189),
        (273, 190),
        (276, 191),
        (277, 192),
        (278, 193),
        (279, 194),
        (280, 195),
        (281, 196),
        (282, 197),
        (283, 198),
        (284, 199),
        (285, 200),
        (286, 201),
        (287, 202),
        (288, 203),
        (289, 204),
        (292, 205),
        (293, 206),
        (296, 207),
        (297, 208),
        (300, 209),
        (301, 210),
        (302, 211),
        (303, 212),
        (304, 213),
        (305, 214),
        (308, 215),
        (309, 216),
        (313, 217),
        (314, 218),
        (317, 219),
        (318, 220),
        (319, 221),
        (320, 222),
        (321, 223),
        (322, 224),
        (323, 225),
        (324, 226),
        (327, 227),
        (328, 228),
        (334, 229),
        (335, 230),
        (336, 231),
        (337, 232),
        (338, 233),
        (339, 234),
        (340, 235),
        (341, 236),
        (344, 237),
        (345, 238),
        (346, 239),
        (347, 240),
        (348, 241),
        (349, 242),
        (350, 243),
        (351, 244),
        (352, 245),
        (353, 246),
        (356, 247),
        (357, 248),
        (360, 249),
        (361, 250),
        (364, 251),
        (365, 252),
        (366, 253),
        (367, 254),
        (368, 255),
        (369, 256),
        (370, 257),
        (371, 258),
        (372, 259),
        (373, 260),
        (374, 261),
        (375, 262),
        (376, 263),
        (377, 264),
        (378, 265),
        (379, 266),
        (380, 267),
        (381, 268),
        (382, 269),
        (461, 270),
        (462, 271),
        (463, 272),
        (464, 273),
        (465, 274),
        (466, 275),
        (467, 276),
        (468, 277),
        (486, 278),
        (487, 279),
        (488, 280),
        (489, 281),
        (490, 282),
        (491, 283),
        (500, 284),
        (501, 285),
        (504, 286),
        (505, 287),
        (542, 288),
        (543, 289),
        (550, 290),
        (551, 291),
        (552, 292),
        (553, 293),
        (558, 294),
        (559, 295),
        (710, 296),
        (711, 297),
        (728, 298),
        (729, 299),
        (730, 300),
        (731, 301),
        (732, 302),
        (733, 303),
        (894, 30),
        (8216, 304),
        (8217, 305),
        (8218, 306),
        (8220, 307),
        (8221, 308),
        (8222, 309),
        (8260, 310),
        (8364, 311),
        (8482, 312),
        (8722, 313),
        (8725, 310),
        (8729, 108),
        (8804, 314),
        (8805, 315)
    ];
}